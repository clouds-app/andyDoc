(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c906cf3"],{"0591":function(t,e,s){"use strict";s("dd83")},"0e4a":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:"column"===t.flexDirection?"bodyContentDownBox-V":"bodyContentDownBox-H"},[t.$slots.part1?s("div",{staticClass:"bodyContentDownItem",style:{width:t.config.windowOffsetWidth+"px"}},[t._t("part1",[t._v("part1")])],2):t._e(),t.$slots.part2?s("div",{staticClass:"bodyContentDownItem",style:{width:t.config.windowOffsetWidth+"px"}},[t._t("part2",[t._v("part2")])],2):t._e(),t.$slots.part3?s("div",{staticClass:"bodyContentDownItem",style:{width:t.config.windowOffsetWidth+"px"}},[t._t("part3",[t._v("part3")])],2):t._e()])},a=[],o={name:"bodyContentDownItem",props:{flexDirection:{type:String,default:"column"},config:{type:Object,default:function(){return{windowOffsetHeight:0,windowOffsetWidth:0}}}},data:function(){return{}},methods:{}},n=o,r=(s("33bc"),s("5d22")),c=Object(r["a"])(n,i,a,!1,null,"550d1612",null);e["a"]=c.exports},"33bc":function(t,e,s){"use strict";s("c294")},"572e":function(t,e,s){"use strict";s("f9f5")},"6b2c":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bodyContentBox"},[s("div",{ref:"refBodyContent",staticClass:"bodyContentItem lastItem"},[s("bodyContentDownItem",{attrs:{config:{windowOffsetHeight:t.windowOffsetHeight,windowOffsetWidth:t.windowOffsetWidth}},scopedSlots:t._u([{key:"part1",fn:function(){return[s("div",{staticClass:"roleItemBox",style:{height:.3*t.windowOffsetHeight+"px"}},[s("div",{staticClass:"roleItem firstItem"},[s("nvxe-grid",{ref:"mainTable",attrs:{isMainTable:!0,loading:t.listLoading,toolbarConfig:t.toolbarConfig,height:.3*t.windowOffsetHeight,columnsFormName:t.requstConfig.mainFormName,dataUrl:t.requstConfig.modulePreUrl+"/"+t.mainPageSearchType},on:{setCurrentRow:t.setCurrentRowEvent,"cell-click":t.cellClickEvent}})],1),s("div",{staticClass:"roleItem secondItem"},[s("nvxe-grid",{ref:"fourthTable",attrs:{toolbarConfigShow:!1,height:.3*t.windowOffsetHeight,columnsFormName:t.requstConfig.tab4FormName}})],1)])]},proxy:!0},{key:"part2",fn:function(){return[s("div",{staticClass:"rightItemBox",style:{height:.7*t.windowOffsetHeight+"px"}},[s("div",{staticClass:"rightItem firstItem"},[s("div",{staticClass:"sysFunctionMenuBox"},[s("div",{staticClass:"sysFunctionMenuItem upItem"},[s("span",{staticClass:"cl-title-cb margin-left-10"},[t._v("系统功能目录")])]),s("div",{staticClass:"sysFunctionMenuItem downItem"},[s("el-tree",{ref:"roleSourceTree",staticStyle:{"font-size":"13px"},attrs:{data:t.menuDataList,"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,"render-content":function(e,s){var i=s.node,a=s.data,o=s.store;return t.renderContent(e,{node:i,data:a,store:o},"label")}},on:{"node-click":t.handleNodeClick}})],1)])]),s("div",{staticClass:"rightItem secondItem"},[s("nvxe-edit-grid",{ref:"firstTable",attrs:{resizable:!1,loading:t.firstTableLoading,toolbarConfigShow:!1,checkboxColumnShow:!1,height:.7*t.windowOffsetHeight,columnsFormName:t.requstConfig.tab1FormName},on:{"header-cell-dblclick":function(e){return t.headerCellDblClickEvent("firstTable",e)},"cell-dblclick":function(e){return t.indexCellDblClickEvent("firstTable",e)}}})],1),s("div",{staticClass:"rightItem thirdItem"},[s("nvxe-edit-grid",{ref:"secondTable",attrs:{resizable:!1,loading:t.secondTableLoading,toolbarConfigShow:!1,checkboxColumnShow:!1,height:.7*t.windowOffsetHeight,columnsFormName:t.requstConfig.tab2FormName},on:{"header-cell-dblclick":function(e){return t.headerCellDblClickEvent("secondTable",e)}}})],1),s("div",{staticClass:"rightItem fourthItem"},[s("nvxe-edit-grid",{ref:"thirdTable",attrs:{resizable:!1,loading:t.thirdTableLoading,toolbarConfigShow:!1,checkboxColumnShow:!1,height:.7*t.windowOffsetHeight,columnsFormName:t.requstConfig.tab3FormName},on:{"header-cell-dblclick":function(e){return t.headerCellDblClickEvent("thirdTable",e)}}})],1)])]},proxy:!0}])})],1),s("editBox",{ref:"editBox",on:{submitSuccess:t.submitSuccess}}),s("editUserRoles",{ref:"editRoleUsers",attrs:{currentUserId:t.currentUserId},on:{refreshDataList:t.refreshDataList,submitSuccess:t.submitSuccess}})],1)},a=[],o=(s("27ae"),s("591f"),s("feb3"),s("3337"),s("b3b0"),s("a5f8"),s("16ca"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("nvxe-modal",{attrs:{title:"角色管理",subTitle:"",loading:t.vxeModalLoading},on:{confirm:function(e){return t.submitEvent()}},model:{value:t.showEditRoleUsersBox,callback:function(e){t.showEditRoleUsersBox=e},expression:"showEditRoleUsersBox"}},[s("div",{ref:"editBoxBodyContent",staticClass:"editBoxBodyContentDefaultHW"},[s("editBoxContentPartition",{attrs:{config:{windowOffsetHeight:t.windowOffsetHeight,windowOffsetWidth:t.windowOffsetWidth}},scopedSlots:t._u([{key:"part1",fn:function(){return[s("div",{staticClass:"roleUsersBox",style:{height:t.windowOffsetHeight+"px"}},[s("div",{staticClass:"roleUsersItem firstItem"},[s("nvxe-edit-grid",{ref:"firstTable",attrs:{toolbarConfigShow:!1,height:t.windowOffsetHeight-5,columnsFormName:t.requstConfig.tab1FormName},on:{"checkbox-change":t.canAddDataCheck,"checkbox-all":t.canAddDataCheck},scopedSlots:t._u([{key:"top",fn:function(){return[s("div",{staticClass:"borderSetting cl-title-cb"},[s("span",{staticClass:"margin-left-10"},[t._v("未有用户角色")])])]},proxy:!0}])})],1),s("div",{staticClass:"roleUsersItem secondItem"},[s("div",{staticClass:"secondSubItemBox"},[s("div",{staticClass:"secondSubItem"},[s("vxe-button",{attrs:{disabled:!t.canAddData,status:"success"},on:{click:function(e){return t.addDataEvent()}}},[s("div",{staticClass:"iconTextCenter"},[s("span",{staticClass:"textMargin5"},[t._v("添加")]),t._v(" "),s("i",{staticClass:"vxe-icon--d-arrow-right"})])])],1),s("div",{staticClass:"secondSubItem"},[s("vxe-button",{attrs:{disabled:!t.canRemoveData,status:"danger"},on:{click:function(e){return t.removeDataEvent()}}},[s("div",{staticClass:"iconTextCenter"},[s("i",{staticClass:"vxe-icon--d-arrow-left"}),t._v(" "),s("span",{staticClass:"textMargin5"},[t._v("移除")])])])],1)])]),s("div",{staticClass:"roleUsersItem thirdItem"},[s("nvxe-edit-grid",{ref:"secondTable",attrs:{toolbarConfigShow:!1,height:t.windowOffsetHeight-5,columnsFormName:t.requstConfig.tab2FormName},on:{"checkbox-change":t.canRemoveDataCheck,"checkbox-all":t.canRemoveDataCheck},scopedSlots:t._u([{key:"top",fn:function(){return[s("div",{staticClass:"borderSetting cl-title-cb"},[s("span",{staticClass:"margin-left-10"},[t._v("已有用户角色")])])]},proxy:!0}])})],1)])]},proxy:!0}])})],1)])}),n=[],r=(s("e3b5"),s("47b8"),s("24a8"),s("6b6c")),c=(s("5180"),{name:"edit-roleUsers",components:{},props:{currentUserId:{type:String,default:""}},data:function(){return{canAddData:!1,canRemoveData:!1,firstTableDataList:[],secondTableDataList:[],vxeModalLoading:!1,windowOffsetHeight:0,windowOffsetWidth:0,showEditRoleUsersBox:!1,requstConfig:{modulePreUrl:"/sys/user",tab1FormName:"userroleFm",tab2FormName:"userroleFm"}}},computed:{windowIsResize:function(){return this.$store.state.app.windowIsResize.editWindow}},watch:{windowIsResize:function(t,e){this.getContentWindowWidthHeight()},showEditRoleUsersBox:function(t,e){var s=this;t?(this.getContentWindowWidthHeight(),this.$nextTick((function(){s.getUsersWithRole()}))):this.resetData()}},methods:{resetData:function(){this.canAddData=!1,this.canRemoveData=!1,this.firstTableDataList=[],this.secondTableDataList=[],this.vxeModalLoading=!1},canAddDataCheck:function(){try{var t=this.$refs["firstTable"].$refs["originEditTalbe"];this.canAddData=!!t&&t.getCheckboxRecords().length>0}catch(e){this.canAddData=!1}},canRemoveDataCheck:function(){try{var t=this.$refs["secondTable"].$refs["originEditTalbe"];this.canRemoveData=!!t&&t.getCheckboxRecords().length>0}catch(e){this.canRemoveData=!1}},submitEvent:function(){var t=this.$refs["secondTable"].$refs["originEditTalbe"];if(t){var e="/sys/user/saveUserRole",s=t.getTableData().tableData;s.length>0&&(s=s.map((function(t){return t.id.includes("row_")&&(t.id=null),t})));var i={userId:this.currentUserId,sysUserRoleList:s},a=this;r["a"].post(e,i).then((function(t){a.$XModal.message({message:"操作成功!",status:"success"}),a.$emit("refreshDataList",""),a.showEditRoleUsersBox=!1}))}},addDataEvent:function(){var t=this,e=this.$refs["firstTable"].$refs["originEditTalbe"];if(e){var s=e.getCheckboxRecords(),i=this.$refs["secondTable"].$refs["originEditTalbe"];i&&(i.insertAt(s,-1),t.setFirstTableData(),this.canAddData=!1)}},removeDataEvent:function(){var t=this,e=this.$refs["secondTable"].$refs["originEditTalbe"];e&&(e.removeCheckboxRow(),t.setFirstTableData(),t.canRemoveData=!1)},setFirstTableData:function(){var t=this.$refs["firstTable"].$refs["originEditTalbe"],e=this.$refs["secondTable"].$refs["originEditTalbe"];if(t){var s=e.getTableData().tableData,i=[].concat(this.firstTableDataList),a=i.filter((function(t){var e=s.findIndex((function(e){return t.roleId==e.roleId}));if(-1==e)return t}));t.reloadData(a)}},setSecondTableData:function(){var t=this.$refs["secondTable"].$refs["originEditTalbe"];t&&t.reloadData(this.secondTableDataList)},getUsersWithoutRole:function(){var t="/sys/user/getRoleInfo",e={},s=this;r["a"].post(t,e).then((function(t){s.firstTableDataList=t,s.setFirstTableData()}))},getUsersWithRole:function(){var t="/sys/user/user-role?userId=".concat(this.currentUserId),e={},s=this;r["a"].post(t,e).then((function(t){s.secondTableDataList=t,s.setSecondTableData(),s.getUsersWithoutRole()}))},getContentWindowWidthHeight:function(){this.vxeModalLoading=!0;var t=this;this.$nextTick((function(){t.windowOffsetHeight=0,t.windowOffsetWidth=0,clearTimeout(t.editWindowReSizeTimer),t.editWindowReSizeTimer=setTimeout((function(){var e=t.$refs["editBoxBodyContent"];if(e&&e.offsetHeight){var s=e.offsetHeight,i=e.offsetWidth;t.windowOffsetHeight=Number(s),t.windowOffsetWidth=Number(i)}t.vxeModalLoading=!1}),300)}))}}}),d=c,l=(s("0591"),s("5d22")),u=Object(l["a"])(d,o,n,!1,null,"01ae23dd",null),f=u.exports,h=s("1b62"),m=s("2ddf"),b=s("0e4a"),g=function(){return{component:Promise.all([s.e("chunk-f042a250"),s.e("chunk-36011954")]).then(s.bind(null,"0122")),loading:"loadding...",error:"error...",delay:20200,timeout:3e3}},v={name:"user",components:{editBox:g,editUserRoles:f,bodyContentDownItem:b["a"]},data:function(){return{postFormatPostData:{},headerCellDblClickInfo:{},hasUpdateRecords:!1,firstTableLoading:!1,secondTableLoading:!1,thirdTableLoading:!1,currentResourceId:"",currentUserId:"",menuDataList:[],toolbarConfig:{slots:{buttons:"toolbar_buttons"}},requstConfig:{modulePreUrl:"/sys/user",mainFormName:"sysuserFm",tab1FormName:"sysuserresourceFm",tab2FormName:"sysuserresourceexpFm",tab3FormName:"sysuserreportFm",tab4FormName:"userroleFm"}}},mixins:[h["a"],m["a"]],created:function(){this.getMenuDataList()},methods:{refreshDataList:function(){this.getRoleUserList()},iisUsersMAction:function(){var t=this.$refs["editRoleUsers"];t&&(t.showEditRoleUsersBox=!0)},iisRightsSAction:function(){var t=this;this.$XModal.confirm({status:"warning",message:"确定要保存权限？"}).then((function(e){"confirm"===e&&t.submitUpdateDataList()}))},formatPostData:function(){var t={userId:this.currentUserId,userReportList:this.getUpdateDataList("thirdTable"),sysUserResourceExpList:this.getUpdateDataList("secondTable"),userResourceList:this.getUpdateDataList("firstTable")};return this.postFormatPostData=t,t},submitUpdateDataList:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this,s="/sys/user/save-auth",i={};i=t?this.postFormatPostData:this.formatPostData(),this.request.post(s,i).then((function(t){e.hasUpdateRecords=!1,e.headerCellDblClickInfo={},e.$XModal.message({message:"操作成功!",status:"success"}),setTimeout((function(){e.reloadTableData(),e.postFormatPostData={}}),100)}))},getUpdateDataList:function(t){var e=this.$refs[t],s=[];return e&&(s=e.getUpdateRecords(),s.length>0&&(this.hasUpdateRecords=!0,s=s.map((function(t){return t.id.includes("row_")&&(t.id=null),t})))),s},indexCellDblClickEvent:function(t,e){if(e.columnsFormName){var s=["iisAdd","iisAudit","iisDel","iisDisabled","iisEdit","iisExport","iisImport","iisMoney","iisNotAudit","iisPrint","iisShow"],i=this.$refs[t].$refs["originEditTalbe"];if(i){var a=[e.rowInfo.row];a=a.map((function(t){return s.forEach((function(e){t.hasOwnProperty(e)&&(t[e]=!t[e])})),t}))}}},headerCellDblClickEvent:function(t,e){if(e.columnsFormName){this.headerCellDblClickInfo[t]=!0;var s=e.rowInfo.column.property;if(1!=e.rowInfo.$columnIndex){var i=this.$refs[t].$refs["originEditTalbe"];if(i){var a=i.getTableData().tableData;if(e.rowInfo.$columnIndex>1)a=a.map((function(t){return t[s]=!t[s],t}));else{var o=["iisRight","iisAdd","iisAudit","iisDel","iisDisabled","iisEdit","iisExport","iisImport","iisMoney","iisNotAudit","iisPrint","iisShow"];a=a.map((function(t){return o.forEach((function(e){t.hasOwnProperty(e)&&(t[e]=!t[e])})),t}))}}}}},cellClickEvent:function(t){var e=this;clearTimeout(this.selectTimer),this.selectTimer=setTimeout((function(){e.currentUserId=t.row.id,e.reloadTableData()}),100)},setCurrentRowEvent:function(t){this.currentUserId=t.row.id,this.reloadTableData()},reloadTableData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";"0"!=this.currentResourceId&&this.currentResourceId&&"0"!=this.currentUserId&&this.currentUserId&&(this.getSubTableData("firstTable"),this.getSubTableData("secondTable"),this.getSubTableData("thirdTable")),"0"!=this.currentUserId&&this.currentUserId&&"handleNodeClick"!=t&&this.getRoleUserList()},handleNodeClick:function(t){var e=this;this.formatPostData(),this.hasUpdateRecords?this.$XModal.confirm({status:"warning",message:"有未提交更新数据,是否提交?"}).then((function(s){"confirm"===s?(e.submitUpdateDataList(!0),setTimeout((function(){e.refreshDataSearch(t)}),300)):(e.hasUpdateRecords=!1,e.refreshDataSearch(t))})):(e.hasUpdateRecords=!1,e.refreshDataSearch(t))},refreshDataSearch:function(t){t&&t.id&&(this.currentResourceId=t.id,this.reloadTableData("handleNodeClick"))},getMenuDataList:function(){var t=this;0==this.menuDataList.length&&this.request.get("/sys/resource/tree").then((function(e){t.menuDataList=e}))},getRoleUserList:function(){var t=this.$refs["fourthTable"].$refs["originListTalbe"],e="/sys/user/user-role?userId=".concat(this.currentUserId),s={};t&&this.request.post(e,s).then((function(e){t.reloadData(e)}))},getSubTableData:function(t){var e=this,s=this.$refs[t].$refs["originEditTalbe"],i="",a={};if(this[t+"Loading"]=!0,s){switch(t){case"firstTable":i="/sys/user/getUserResource?resourceId=".concat(this.currentResourceId,"&userId=").concat(this.currentUserId);break;case"secondTable":i="/sys/user/user-expand?resourceId=".concat(this.currentResourceId,"&userId=").concat(this.currentUserId);break;case"thirdTable":i="/sys/user/user-report?resourceId=".concat(this.currentResourceId,"&userId=").concat(this.currentUserId);break;default:break}this.request.post(i,a).then((function(i){e[t+"Loading"]=!1,s.reloadData(i)}))}}}},w=v,C=(s("572e"),Object(l["a"])(w,i,a,!1,null,"16989400",null));e["default"]=C.exports},c294:function(t,e,s){},dd83:function(t,e,s){},f9f5:function(t,e,s){}}]);